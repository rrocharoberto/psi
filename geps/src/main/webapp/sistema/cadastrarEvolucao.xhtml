<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:format="customTagLib/LocalDateTimeConverter"
	xmlns:p="http://primefaces.org/ui">

<h:head>
</h:head>

<ui:composition template="/template/layoutBase.xhtml">
	<ui:define name="content">
	
		<p:dialog header="Prontuário: #{evolucaoController.paciente.numeroProntuario} 
							Paciente: #{evolucaoController.paciente.dadosPessoais.nome}" 
				  id="dialog-modal-evolucao" 
		   		  widgetVar="dialog-modal-evolucao" 
		   		  modal="true" 
		   		  height="500px"
		   		  width="750px">
		   		      	
		   		  <h:form>
		   		  		<p:growl id="messages" life="2000" />
    		 			<p:panelGrid cellpadding="10" style="border:none;">
						
							<p:row  style="border:none;">
								<p:column style="border:none;">
									<p:outputLabel value="Nome do paciente:" for="outputLabel-nome"/>
									<p:outputLabel id="outputLabel-nome" value="#{evolucaoController.paciente.dadosPessoais.nome}"/>
								</p:column>
							</p:row>

	 						<p:row style="border:none;">
								<p:column style="border:none;">
									<p:outputLabel value="Descrição da evolução" for="inputText-descricao"/>
									<p:inputTextarea id="inputText-descricao" 
													style="width:100%;height:120px;"
													value="#{evolucaoController.evolucao.descricao}"
													autofocus="true"
													required="true"
													requiredMessage="A descrição é de preenchimento obrigatório"
													maxlength="499" counterTemplate="{0} characteres restantes"
													counter="display-descricao"/>
									
								</p:column>
							</p:row>
							
							<p:row style="border:none;">
								<p:column style="border:none;">
									<h:outputText id="display-descricao" />
								</p:column>
							</p:row>
							
				 			<p:row style="border:none;">
								<p:column style="border:none;">
									
									<p:commandButton  value="Salvar dados da evolução" 
													action="#{evolucaoController.salvarEvolucao}" 
													process="@form"
													update="messages form-evolucao-paciente"/>
								</p:column>
							</p:row>

							<p:row style="border:none;">
								<p:column style="border:none;">
									<h:outputText value="Evoluções já registradas:" />
								</p:column>
							</p:row>

							<p:row style="border:none;">
								<p:column style="border:none;" colspan="2">
						 			<p:dataTable id="dataTable-registros"
						 						 var="evolucao" 
						 						 value="#{evolucaoController.evolucoes}" 
						 						 rows="15"
						 						 emptyMessage="Nenhuma evolução cadastrada ainda"
						 						 paginator="true"
						 						 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						                         rowsPerPageTemplate="5,10,15">
						 			
						 				<p:column headerText="Data">
						 					<h:outputText value="#{evolucao.id.data}">
												<format:LocalDateTimeConverter pattern="dd/MM/yyyy"/>
											</h:outputText>
						 				</p:column>
						 				
						 				<p:column headerText="Descrição">
						 					<h:outputText value="#{evolucao.descricao}" />
						 				</p:column>
						 				
						 				<p:column headerText="Validado">
						 					<h:outputText value="Sim" rendered="#{evolucao.validado}" />
						 					<h:outputText value="Não" rendered="#{not evolucao.validado}" />
						 				</p:column>
						 			</p:dataTable>
								</p:column>
				 			</p:row>
				 			
						</p:panelGrid>
			</h:form>
		</p:dialog>
	

		<h:panelGrid id="panelGrid-seleciona-paciente" border="2" style="margin: 0 auto;min-width:700px;min-height:500px;" cellpadding="15">
		
			<h:form id="form-evolucao-paciente">
				<p:growl id="messages" life="2000" />
				
				<p:outputLabel value="Não há pacientes cadastrados para você. Procure o funcionário." rendered="#{empty evolucaoController.pacientes}"/>
				
				<p:outputLabel value="Clique no botão de evolução do paciente desejado." rendered="#{not empty evolucaoController.pacientes}"/>

				<p:dataTable id="dataTable-pacientes-evolucao" rendered="#{not empty evolucaoController.pacientes}"
							 var="paciente" 
							 value="#{evolucaoController.pacientes}" 
							 rows="15"
							 emptyMessage="Não há pacientes cadastrados"
							 paginator="true"
							 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	                         rowsPerPageTemplate="5,10,15"
	                         rowStyleClass="#{empty paciente.registro.termoConsentimento ? 'warning' : null}">
				
					<p:column headerText="Nº Prontuário" style="width:100px;">
						<h:outputText value="#{paciente.numeroProntuario}"/>
					</p:column>
					
					<p:column headerText="Nome">
						<h:outputText value="#{paciente.dadosPessoais.nome}" />
					</p:column>
					
					<p:column headerText="Evolução" style="width:200px;">
					
						<p:commandButton icon="fa fa-pencil"  rendered="#{not empty paciente.registro.termoConsentimento}"
										title="Registrar evolução do paciente"    
										style="horizontal-align:center"
										ajax="true"                        					 
										actionListener="#{evolucaoController.prepararEvolucao(paciente.numeroProntuario)}"
										oncomplete="PF('dialog-modal-evolucao').show();" 
										update="dialog-modal-evolucao"/>
						<h:outputText value="Paciente não registrado ainda." rendered="#{empty paciente.registro.termoConsentimento}"/>
					</p:column>
				</p:dataTable>

			</h:form>
			
		</h:panelGrid>
	</ui:define>
</ui:composition>
</html>
